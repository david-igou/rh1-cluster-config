---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: ansible-lint
  namespace: dev-tools
  annotations:
    argocd.argoproj.io/sync-wave: "1"
  labels:
    app: tekton
    task-type: quality
spec:
  description: Run ansible-lint on Ansible content
  params:
    - name: path
      type: string
      description: Path within workspace to lint
      default: "."
    - name: args
      type: string
      description: Additional ansible-lint arguments
      default: ""
  workspaces:
    - name: source
      description: Workspace containing Ansible content
  steps:
    - name: lint
      image: quay.io/ansible/creator-ee:latest
      workingDir: $(workspaces.source.path)/$(params.path)
      script: |
        #!/bin/bash
        set -e
        
        echo "Running ansible-lint on $(params.path)..."
        
        # Check if .ansible-lint config exists
        if [ -f ".ansible-lint" ]; then
          echo "Using .ansible-lint configuration"
        else
          echo "No .ansible-lint found, using defaults"
        fi
        
        # Run ansible-lint
        ansible-lint $(params.args) .
        
        echo "âœ“ ansible-lint passed"

